---
title: 组件开发
nav:
  title: 分析仪
  path: /analyzer
group:
  title: 组件开发
  path: /dev
toc: menu
---

## 配置文件

打开下载的插件包，编辑“../pluginTemp/config.json”配置文件，如下所示。

~~~
{
  "id": "3349b44f-8f66-57ca-bdbf-75d655206b47",
  "type": "analyzer",
  "main": "main.3ca9fd98.js",
  "version": "2",
  "props": {
    "process": true,
    "lib": [],
    "cssDep": [],
    "scriptName": "main.b42fe2f5.js",
    "vars": [],
    "optionModules": [],
    "projectType":"react",
  }
}
~~~

| 参数 | 参数说明 |
| --- | --- |
| id | 插件标识，用户在下载插件模板时，系统自动生成，用户无需自定义。 |
| type | 插件类型，分析仪的插件类型必须配置为analyzer。 |
| main | 插件打包后生成的上级jJS文件名，插件打包时会自动更新此参数，例如：main.\[hash\]. js，用户无需手动配置。 |
| version | 标识插件的版本，目前默认取值为“2”。 |
| props | 插件的相关自定义属性参数，包括如下：<br>● process 是否开启逻辑控制，true 代表开启；false 代表不开启。<br>● lib 内部预留字段，用于非react版插件所需要的依赖文件。<br>● scriptName 插件的 js 文件，项目打包时会自动生成，不需要手动更改。<br>● vars 插件的变量，当插件的某个值需要用户自行输入时，即可在此添加一个变量，在App.js中可通过window.\_\_analysisOptions.externalVariables获取全部变量组成的对象。<br>● optionModules 内部预留字段，用于加载默认模块。<br>● projectType 项目类型，vue 还是 react。 |

## 开发代码

### 配置项

分析仪的用户配置项通过 config.json 里 vars 这个属性来配置自定义配置量。例如，开发一个自定义表格的插件，表格的具有分页功能，每一页有多少行，需要由用户使用时决定，则可以通过 vars 属性来声明插件有这些用户配置项，例如：

~~~
"vars": [
  "num",
  "fast",
  "pix"
]
~~~

通过提供的sdk提供的 getBlockOptions 方法，可以在插件内部拿到用户的配置，例如：

~~~
// 引入
import { getPluginVariables } from "@sdsdk/analyzer-sdk";

// 使用
const data = getBlockOptions();

// data 数据结构
{
  num: 20,
  fast:45,
  pix:''
}
~~~

### 源数据

平台会将分析仪的数据从 props 的 dataSource 属性传递给插件的组件，例如，我有这样一个资产：

| 公司 | 大小 |
| --- | --- |
| A | 21 |
| A | 22 |
| B | 14 |
| B | 23 |
| C | 11 |
| C | 15 |
| D | 26 |
| D | 25 |

那么分析仪插件的 `dataSource` 属性为:

~~~
[
        ["公司", "大小"],
        ["A", 21],
        ["A", 22],
        ["B", 14],
        ["B", 23],
        ["C", 11],
        ["C", 15],
        ["D", 26],
        ["D", 25]
]
~~~

利用此属性，可以在插件中实现其具体的展示样式。

### 代码示例

下例展示如何开发一个简单的表格来展示分析仪数据：

~~~
// src/App.js
import React, { Component } from "react";
import { Table, Button, message } from "antd"; //引入antd
import "./app.less";
import { getAnalysisData } from "@sdsdk/analyzer-sdk";  //引入SDK

export default class App extends Component {
  state = {
    dataSource: [],
    columns: [],
  };

  constructor(props) {
    super(props);
  }

  //加载表格数据源
  loadTableSource = (data) => {
    let title = data[0];
    try {
      const columns = title.map((item, index) => ({
        title: item,
        dataIndex: item,
        key: index,
        align: "center",
        ellipsis: true,
      }));
      this.setState({ columns });
    } catch (error) {
      console.error(error);
    }
    let dataSourceInit = data.slice(1);
    let dataSource = [];
    dataSourceInit.forEach((item, index) => {
      let obj = {};
      item.forEach((it, i) => {
        obj[title[i]] = it;
        obj.key = index;
      });
      dataSource.push(obj);
    });
    this.setState({ dataSource });
  };
  componentDidMount() {
    const { dataSource, updateProcess, componentId } = this.props;
    // updateProcess，componentId 是分析仪需要触发逻辑控制需要的变量，
    const data = dataSource;
    // 加载表格
    this.loadTableSource(data);
    updateProcess && updateProcess();
  }

  render() {
    console.log("getAnalysisData", getAnalysisData());
    const { componentId } = this.props;
    const { dataSource, rowId, columns } = this.state;
    return (
      <div className="analyzer-demo" style={{ width: "100%", height: "100%" }}>
        <Table
          columns={columns}
          dataSource={dataSource}
          pagination={false}
          size="small"
          onRow={(_, index) => {
            return {
              onClick: () => {
                console.log('hello world');
              },
            };
          }}
          scroll={{ y: "calc(100% - 39px)" }}
          style={{ height: "calc(100% - 63px)" }}
        />
      </div>
    );
  }
}
~~~
